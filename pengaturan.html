<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shortcut Manager</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

    <style>
        :root {
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.1);
            --accent-primary: #00f2fe;
            --accent-secondary: #4facfe;
            --text-main: #f8fafc;
            --text-dim: #94a3b8;
            --bg-color: #020617;
            --danger: #ff4b5c;
            --success: #22c55e;
        }

        * {
            box-sizing: border-box;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: radial-gradient(circle at 50% 0%, #1e293b 0%, #020617 100%);
            background-attachment: fixed;
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            justify-content: center;
        }

        .admin-page-container {
            width: 95%;
            max-width: 850px;
            margin: 40px 20px;
            padding: 35px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 32px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7);
        }

        .header-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        .header-section h1 {
            font-size: 1.8rem;
            margin: 0;
            background: linear-gradient(135deg, #fff 0%, var(--accent-primary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        .action-group {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 12px 20px;
            border-radius: 14px;
            border: none;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .btn-add {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid var(--glass-border);
        }

        .btn-add:hover {
            background: white;
            color: black;
            transform: translateY(-2px);
        }

        .btn-save {
            background: linear-gradient(135deg, var(--accent-secondary), var(--accent-primary));
            color: #002233;
            box-shadow: 0 10px 20px -5px rgba(79, 172, 254, 0.4);
        }

        .btn-save:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 15px 25px -5px rgba(79, 172, 254, 0.6);
        }

        .admin-list-item {
            display: flex;
            align-items: center;
            padding: 18px 24px;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            position: relative;
            overflow: hidden;
        }

        .admin-list-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--accent-primary);
            transform: translateY(-4px) scale(1.01);
            box-shadow: 0 10px 30px -10px rgba(0, 242, 254, 0.2);
        }

        .drag-handle {
            cursor: grab;
            color: var(--text-dim);
            padding: 10px;
            font-size: 1.1rem;
        }

        .admin-item-icon {
            width: 50px;
            height: 50px;
            background: rgba(0, 242, 254, 0.08);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-primary);
            font-size: 1.4rem;
            margin: 0 20px;
        }

        .admin-item-details { flex: 1; min-width: 0; }
        .admin-item-name { display: block; font-weight: 700; margin-bottom: 3px; }
        .admin-item-url { font-size: 0.8rem; color: var(--text-dim); }

        .btn-icon {
            width: 38px;
            height: 38px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.05);
            color: white;
        }

        .btn-icon:hover { background: white; color: black; }
        .btn-icon.delete:hover { background: var(--danger); color: white; }

        #modal-overlay {
            position: fixed; inset: 0;
            background: rgba(0, 2, 10, 0.85);
            backdrop-filter: blur(12px);
            display: flex; justify-content: center; align-items: center;
            z-index: 1000; opacity: 0; visibility: hidden;
        }

        #modal-overlay.active { opacity: 1; visibility: visible; }

        .modal-form {
            background: #0f172a;
            border: 1px solid var(--glass-border);
            padding: 40px;
            border-radius: 28px;
            width: 90%; max-width: 450px;
        }

        .modal-form input {
            width: 100%; padding: 14px; margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 12px; color: white;
        }

        .status-badge {
            font-size: 0.75rem;
            padding: 4px 12px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-dim);
            margin-left: 10px;
        }

        .unsaved { color: #fbbf24; border: 1px solid #fbbf24; }
    </style>
</head>
<body>

    <div class="admin-page-container">
        <div class="header-section">
            <div>
                <h1>Shortcut Manager</h1>
                <p id="status-text" style="font-size: 0.8rem; color: var(--text-dim); margin-top: 5px;">Data sesuai dengan server</p>
            </div>
            <div class="action-group">
                <button class="btn btn-add" onclick="openModal()">
                    <i class="fa-solid fa-plus"></i> Tambah
                </button>
                <button class="btn btn-save" onclick="saveToFirebase()">
                    <i class="fa-solid fa-cloud-arrow-up"></i> Simpan Perubahan
                </button>
            </div>
        </div>

        <div id="admin-list-container">
            <p style="text-align: center; color: var(--text-dim);">Menghubungkan ke server...</p>
        </div>
    </div>

    <div id="modal-overlay">
        <div class="modal-form">
            <h2 id="modal-title" style="margin-top:0">Tambah Baru</h2>
            <input type="text" id="shortcut-name" placeholder="Nama Aplikasi" />
            <input type="text" id="shortcut-url" placeholder="URL (https://...)" />
            <input type="text" id="shortcut-icon" placeholder="Emoji atau FontAwesome" /> 
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn btn-add" onclick="closeModal()">Batal</button>
                <button class="btn btn-save" onclick="applyLocalChange()">Terapkan</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyCba6M_spBXvuG91Zn-XWJ4bSTX6vNcST0",
            authDomain: "index-68220.firebaseapp.com",
            databaseURL: "https://index-68220-default-rtdb.firebaseio.com",
            projectId: "index-68220",
            storageBucket: "index-68220.firebasestorage.app",
            messagingSenderId: "633087068802",
            appId: "1:633087068802:web:f8aa1f2ef9c00b99d1429b",
            measurementId: "G-2VQCRFJQCM"
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const dbPath = 'artifacts/user-shortcuts/shortcuts/list';

        let localData = []; 
        let editingIndex = null;

        async function loadInitialData() {
            const snapshot = await get(ref(db, dbPath));
            const data = snapshot.val() || {};
            localData = Object.keys(data).map(key => ({ id: key, ...data[key] }));
            localData.sort((a, b) => (a.order ?? 0) - (b.order ?? 0));
            renderList();
        }

        function renderList() {
            const container = document.getElementById('admin-list-container');
            container.innerHTML = '';

            localData.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'admin-list-item';
                div.setAttribute('data-index', index);
                
                let iconDisplay = item.icon?.startsWith('fa-') ? `<i class="${item.icon}"></i>` : (item.icon || 'ðŸ”—');

                div.innerHTML = `
                    <div class="drag-handle"><i class="fa-solid fa-grip-vertical"></i></div>
                    <div class="admin-item-icon">${iconDisplay}</div>
                    <div class="admin-item-details">
                        <span class="admin-item-name">${item.name}</span>
                        <span class="admin-item-url">${item.url}</span>
                    </div>
                    <div class="action-group">
                        <button class="btn-icon" onclick="editLocal(${index})"><i class="fa-solid fa-pen"></i></button>
                        <button class="btn-icon delete" onclick="deleteLocal(${index})"><i class="fa-solid fa-trash"></i></button>
                    </div>
                `;
                container.appendChild(div);
            });
            initSortable();
        }

        function initSortable() {
            new Sortable(document.getElementById('admin-list-container'), {
                animation: 250,
                handle: '.drag-handle',
                onEnd: (evt) => {
                    const movedItem = localData.splice(evt.oldIndex, 1)[0];
                    localData.splice(evt.newIndex, 0, movedItem);
                    markAsUnsaved();
                }
            });
        }

        window.applyLocalChange = () => {
            const name = document.getElementById('shortcut-name').value;
            const url = document.getElementById('shortcut-url').value;
            const icon = document.getElementById('shortcut-icon').value;

            if (editingIndex !== null) {
                localData[editingIndex] = { ...localData[editingIndex], name, url, icon };
            } else {
                localData.push({ id: Date.now().toString(), name, url, icon });
            }
            markAsUnsaved();
            renderList();
            closeModal();
        };

        window.deleteLocal = (index) => {
            if (confirm('Hapus item ini?')) {
                localData.splice(index, 1);
                markAsUnsaved();
                renderList();
            }
        };

        window.editLocal = (index) => {
            editingIndex = index;
            const item = localData[index];
            document.getElementById('shortcut-name').value = item.name;
            document.getElementById('shortcut-url').value = item.url;
            document.getElementById('shortcut-icon').value = item.icon;
            document.getElementById('modal-title').textContent = 'Edit Shortcut';
            openModal();
        };

        window.saveToFirebase = async () => {
            const btn = document.querySelector('.btn-save');
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Menyimpan...';
            
            const finalData = {};
            localData.forEach((item, index) => {
                finalData[item.id || index] = {
                    name: item.name,
                    url: item.url,
                    icon: item.icon,
                    order: index,
                    updated: Date.now()
                };
            });

            try {
                await set(ref(db, dbPath), finalData);
                document.getElementById('status-text').innerHTML = '<span style="color:var(--success)">âœ“ Semua perubahan tersimpan</span>';
                btn.innerHTML = '<i class="fa-solid fa-cloud-arrow-up"></i> Simpan Perubahan';
            } catch (e) {
                alert('Gagal menyimpan ke server!');
            }
        };

        function markAsUnsaved() {
            document.getElementById('status-text').innerHTML = '<span class="status-badge unsaved">Ada perubahan yang belum disimpan</span>';
        }

        window.openModal = () => document.getElementById('modal-overlay').classList.add('active');
        window.closeModal = () => {
            document.getElementById('modal-overlay').classList.remove('active');
            editingIndex = null;
            document.getElementById('shortcut-name').value = '';
            document.getElementById('shortcut-url').value = '';
            document.getElementById('shortcut-icon').value = '';
        };

        window.onload = loadInitialData;
    </script>
</body>
</html>
