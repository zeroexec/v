<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shortcut Manager Pro</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

    <style>
        :root {
            --glass-bg: rgba(15, 23, 42, 0.85);
            --glass-border: rgba(255, 255, 255, 0.1);
            --accent: #00f2fe;
            --bg: #020617;
        }

        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }

        body {
            margin: 0; font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--bg); color: #fff; min-height: 100vh;
            display: flex; justify-content: center;
        }

        .container {
            width: 95%; max-width: 700px; margin: 40px 10px; padding: 25px;
            background: var(--glass-bg); backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border); border-radius: 24px;
        }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }

        .btn-add {
            padding: 10px 18px; border-radius: 12px; border: none;
            background: var(--accent); color: #000; font-weight: 800; cursor: pointer;
            transition: transform 0.2s;
        }

        .btn-add:active { transform: scale(0.95); }

        .list-item {
            display: flex; align-items: center; padding: 12px 16px; margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.04); border-radius: 16px;
            border: 1px solid transparent; transform: translateZ(0);
        }

        .handle { cursor: grab; color: #475569; padding-right: 15px; font-size: 1.2rem; }

        .icon-box {
            width: 40px; height: 40px; background: rgba(255, 255, 255, 0.05);
            border-radius: 10px; display: flex; align-items: center; justify-content: center;
            margin-right: 15px; color: var(--accent); font-size: 1.2rem;
        }

        .details { flex: 1; overflow: hidden; }
        .details b { display: block; font-size: 0.95rem; }
        .details span { font-size: 0.75rem; color: #94a3b8; display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

        .actions { display: flex; gap: 8px; }
        .btn-icon {
            width: 34px; height: 34px; border-radius: 8px; border: none;
            background: rgba(255, 255, 255, 0.06); color: #fff; cursor: pointer;
        }
        .btn-icon:hover { background: #fff; color: #000; }
        .btn-icon.del:hover { background: #ef4444; color: #fff; }

        #modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.8);
            display: none; justify-content: center; align-items: center; z-index: 1000;
        }
        .modal-content { background: #1e293b; padding: 25px; border-radius: 20px; width: 90%; max-width: 400px; }
        input {
            width: 100%; padding: 12px; margin: 8px 0; border-radius: 10px;
            border: 1px solid #334155; background: #0f172a; color: #fff; outline: none;
        }

        .status { font-size: 0.8rem; color: var(--accent); font-weight: 600; height: 20px; }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <div>
                <h2 style="margin:0">Shortcuts</h2>
                <div id="status" class="status">Menunggu...</div>
            </div>
            <button class="btn-add" onclick="openModal()">+ Baru</button>
        </div>
        <div id="list-container"></div>
    </div>

    <div id="modal">
        <div class="modal-content">
            <h3 id="modal-title" style="margin-top:0">Entry Data</h3>
            <input type="text" id="in-name" placeholder="Nama Aplikasi" />
            <input type="text" id="in-url" placeholder="URL (https://...)" />
            <input type="text" id="in-icon" placeholder="Ikon (Emoji atau fa-brand)" />
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button class="btn-add" style="background:#475569; color:#fff" onclick="closeModal()">Batal</button>
                <button class="btn-add" style="flex:1" onclick="submitData()">Simpan</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCba6M_spBXvuG91Zn-XWJ4bSTX6vNcST0",
            authDomain: "index-68220.firebaseapp.com",
            databaseURL: "https://index-68220-default-rtdb.firebaseio.com",
            projectId: "index-68220",
            appId: "1:633087068802:web:f8aa1f2ef9c00b99d1429b"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const dbRef = ref(db, 'artifacts/user-shortcuts/shortcuts/list');

        let localData = [];
        let currentEditId = null;
        let saveTimer;

        async function fetchData() {
            try {
                const snap = await get(dbRef);
                const data = snap.val() || {};
                localData = Object.keys(data).map(k => ({ id: k, ...data[k] }))
                             .sort((a,b) => (a.order || 0) - (b.order || 0));
                render();
                document.getElementById('status').innerText = 'Sistem Siap';
            } catch(e) {
                document.getElementById('status').innerText = 'Koneksi Bermasalah';
            }
        }

        function render() {
            const container = document.getElementById('list-container');
            container.innerHTML = '';
            
            localData.forEach(item => {
                const el = document.createElement('div');
                el.className = 'list-item';
                el.setAttribute('data-id', item.id);
                
                let iconHtml = item.icon?.startsWith('fa-') ? `<i class="fa-brands ${item.icon}"></i>` : (item.icon || 'üîó');

                el.innerHTML = `
                    <div class="handle">‚ãÆ‚ãÆ</div>
                    <div class="icon-box">${iconHtml}</div>
                    <div class="details">
                        <b>${item.name}</b>
                        <span>${item.url}</span>
                    </div>
                    <div class="actions">
                        <button class="btn-icon edit-btn"><i class="fa-solid fa-pen"></i></button>
                        <button class="btn-icon del del-btn"><i class="fa-solid fa-trash"></i></button>
                    </div>
                `;

                el.querySelector('.edit-btn').onclick = () => openModal(item.id);
                el.querySelector('.del-btn').onclick = () => deleteData(item.id);
                
                container.appendChild(el);
            });
            initSort();
        }

        function initSort() {
            Sortable.create(document.getElementById('list-container'), {
                handle: '.handle',
                animation: 180,
                onEnd: () => {
                    const ids = Array.from(document.getElementById('list-container').children)
                                     .map(el => el.getAttribute('data-id'));
                    localData = ids.map(id => localData.find(d => d.id === id));
                    autoSave();
                }
            });
        }

        window.submitData = () => {
            const name = document.getElementById('in-name').value;
            const url = document.getElementById('in-url').value;
            const icon = document.getElementById('in-icon').value;
            if(!name || !url) return;

            if(currentEditId) {
                const idx = localData.findIndex(d => d.id === currentEditId);
                localData[idx] = { ...localData[idx], name, url, icon };
            } else {
                localData.push({ id: 'ID_'+Date.now(), name, url, icon });
            }
            
            render();
            autoSave();
            closeModal();
        };

        window.deleteData = (id) => {
            if(!confirm('Hapus item?')) return;
            localData = localData.filter(d => d.id !== id);
            render();
            autoSave();
        };

        function autoSave() {
            document.getElementById('status').innerHTML = '<span style="color:#fbbf24">‚è≥ Menyimpan...</span>';
            clearTimeout(saveTimer);
            saveTimer = setTimeout(async () => {
                const toSave = {};
                localData.forEach((d, i) => { toSave[d.id] = { ...d, order: i }; });
                try {
                    await set(dbRef, toSave);
                    document.getElementById('status').innerHTML = '‚úÖ Sinkron';
                } catch(e) {
                    document.getElementById('status').innerHTML = '‚ùå Gagal';
                }
            }, 1200);
        }

        window.openModal = (id = null) => {
            currentEditId = id;
            if(id) {
                const d = localData.find(item => item.id === id);
                document.getElementById('in-name').value = d.name;
                document.getElementById('in-url').value = d.url;
                document.getElementById('in-icon').value = d.icon;
                document.getElementById('modal-title').innerText = "Edit Shortcut";
            } else {
                ['in-name','in-url','in-icon'].forEach(i => document.getElementById(i).value = '');
                document.getElementById('modal-title').innerText = "Tambah Baru";
            }
            document.getElementById('modal').style.display = 'flex';
        };

        window.closeModal = () => document.getElementById('modal').style.display = 'none';

        window.onload = fetchData;
    </script>
</body>
</html>
