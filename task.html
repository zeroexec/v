<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VΞLION TASK</title>
    <link rel="icon" href="logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root {
            --bg: #000000;
            --card-bg: #0a0a0a;
            --neon: #00f2ff;
            --text-main: #ffffff;
            --text-dim: #555555;
            --border: #1a1a1a;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; border-radius: 0 !important; }

        body {
            background-color: var(--bg);
            color: var(--text-main);
            min-height: 100vh;
        }

        .header {
            position: sticky; top: 0; z-index: 100;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            padding: 20px 5%;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 2px solid var(--border);
        }

        .header h1 { 
            font-size: 0.9rem; font-weight: 600; letter-spacing: 5px;
            color: #fff;
        }

        #addTaskButton {
            background: #fff; color: #000; border: none;
            padding: 10px 25px; font-weight: 600; font-size: 0.7rem;
            cursor: pointer; transition: 0.2s;
            letter-spacing: 2px;
        }
        #addTaskButton:hover { background: var(--neon); box-shadow: 0 0 20px var(--neon); }

        .content { padding: 40px 5%; max-width: 1400px; margin: 0 auto; }

        #tasksGrid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }

        .task-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            padding: 30px;
            display: flex; flex-direction: column;
            justify-content: space-between;
            transition: 0.3s;
            position: relative;
            cursor: pointer;
        }

        .task-card:hover {
            border-color: var(--neon);
            background: #0f0f0f;
            transform: translateY(-5px);
            box-shadow: -5px 5px 0px var(--neon);
        }

        .task-card-title {
            font-size: 1rem; font-weight: 300; color: #fff;
            margin-bottom: 30px; line-height: 1.6;
        }

        .task-footer {
            display: flex; justify-content: space-between; align-items: center;
            border-top: 1px solid var(--border); padding-top: 15px;
        }

        .task-timestamp { font-size: 0.65rem; color: var(--text-dim); letter-spacing: 1px; }

        .complete-btn {
            background: transparent; border: 1px solid var(--border);
            color: #fff; width: 35px; height: 35px;
            cursor: pointer; display: flex; 
            align-items: center; justify-content: center;
            transition: 0.2s;
        }
        .complete-btn:hover {
            border-color: var(--neon); color: var(--neon);
            box-shadow: 0 0 10px var(--neon);
        }

        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95);
            display: none; align-items: center; justify-content: center;
            z-index: 1000;
        }
        .modal-overlay.active { display: flex; }

        .modal-content {
            background: #000; border: 2px solid var(--neon);
            padding: 40px; width: 90%; max-width: 450px;
        }

        textarea {
            width: 100%; background: #000; border: 1px solid var(--border);
            color: #fff; padding: 15px; font-size: 1rem;
            resize: none; margin-bottom: 20px; outline: none;
        }
        textarea:focus { border-color: var(--neon); }

        .modal-actions { display: flex; gap: 15px; justify-content: flex-end; }

        .btn { padding: 12px 30px; font-weight: 600; cursor: pointer; border: none; font-size: 0.75rem; letter-spacing: 1px; }
        .btn-ghost { background: transparent; color: var(--text-dim); border: 1px solid var(--border); }
        .btn-primary { background: var(--neon); color: #000; }

        @media (max-width: 640px) { #tasksGrid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <header class="header">
        <h1>VΞLION TASK</h1>
        <button id="addTaskButton" onclick="openAddTaskModal()">ADD_NEW</button>
    </header>

    <main class="content">
        <div id="tasksGrid"></div>
    </main>

    <div class="modal-overlay" id="addTaskModalOverlay">
        <div class="modal-content">
            <h2 style="margin-bottom: 20px; font-size: 0.9rem; letter-spacing: 3px;">NEW_TASK</h2>
            <textarea id="newTitle" rows="4"></textarea>
            <div class="modal-actions">
                <button class="btn btn-ghost" onclick="closeModals()">CANCEL</button>
                <button class="btn btn-primary" id="saveNewTaskBtn">SAVE</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="editModalOverlay">
        <div class="modal-content">
            <h2 style="margin-bottom: 20px; font-size: 0.9rem; letter-spacing: 3px;">EDIT_TASK</h2>
            <input type="hidden" id="editTaskId">
            <textarea id="editTitle" rows="4"></textarea>
            <div class="modal-actions">
                <button class="btn btn-ghost" onclick="closeModals()">CANCEL</button>
                <button class="btn btn-primary" id="doneEditBtn">UPDATE</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="confirmationModal">
        <div class="modal-content" style="text-align: center;">
            <p id="confirmationMessage" style="margin-bottom: 30px; font-size: 0.9rem; letter-spacing: 1px;"></p>
            <div class="modal-actions" style="justify-content: center;">
                <button class="btn btn-ghost" onclick="closeModals()">NO</button>
                <button class="btn btn-primary" id="confirmOK">YES_COMPLETE</button>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCba6M_spBXvuG91Zn-XWJ4bSTX6vNcST0",
            authDomain: "index-68220.firebaseapp.com",
            databaseURL: "https://index-68220-default-rtdb.firebaseio.com",
            projectId: "index-68220",
            storageBucket: "index-68220.firebasestorage.app",
            messagingSenderId: "633087068802",
            appId: "1:633087068802:web:f8aa1f2ef9c00b99d1429b",
            measurementId: "G-2VQCRFJQCM"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const TASKS_REF = database.ref('tasks_only');

        let allTasks = {};
        const tasksGrid = document.getElementById('tasksGrid');

        function closeModals() {
            document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('active'));
        }

        window.openAddTaskModal = () => {
            document.getElementById('newTitle').value = '';
            document.getElementById('addTaskModalOverlay').classList.add('active');
            document.getElementById('newTitle').focus();
        };

        document.getElementById('saveNewTaskBtn').onclick = () => {
            const title = document.getElementById('newTitle').value.trim();
            if (title) {
                TASKS_REF.push({ title, timestamp: new Date().toISOString() });
                closeModals();
            }
        };

        window.openEditModal = (taskId) => {
            const task = allTasks[taskId];
            if (!task) return;
            document.getElementById('editTaskId').value = taskId;
            document.getElementById('editTitle').value = task.title;
            document.getElementById('editModalOverlay').classList.add('active');
        };

        document.getElementById('doneEditBtn').onclick = () => {
            const id = document.getElementById('editTaskId').value;
            const title = document.getElementById('editTitle').value.trim();
            if (id && title) {
                TASKS_REF.child(id).update({ title, timestamp: new Date().toISOString() });
                closeModals();
            }
        };

        window.completeTask = (taskId) => {
            document.getElementById('confirmationMessage').textContent = "MARK AS COMPLETE?";
            document.getElementById('confirmationModal').classList.add('active');
            document.getElementById('confirmOK').onclick = () => {
                TASKS_REF.child(taskId).remove();
                closeModals();
            };
        };

        function renderTasks() {
            tasksGrid.innerHTML = '';
            const keys = Object.keys(allTasks).sort((a, b) => 
                (allTasks[b].timestamp || '').localeCompare(allTasks[a].timestamp || '')
            );

            if (keys.length === 0) {
                tasksGrid.innerHTML = `<div style="grid-column: 1/-1; text-align: center; padding: 100px; color: var(--text-dim); letter-spacing: 5px; font-size: 0.7rem;">SYSTEM_EMPTY</div>`;
                return;
            }

            keys.forEach(id => {
                const task = allTasks[id];
                const card = document.createElement('div');
                card.className = 'task-card';
                card.onclick = (e) => {
                    if (!e.target.closest('.complete-btn')) openEditModal(id);
                };
                
                card.innerHTML = `
                    <div class="task-card-title">${task.title}</div>
                    <div class="task-footer">
                        <span class="task-timestamp">${new Date(task.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', hour12: false})}</span>
                        <button class="complete-btn" onclick="event.stopPropagation(); completeTask('${id}')">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                        </button>
                    </div>
                `;
                tasksGrid.appendChild(card);
            });
        }

        TASKS_REF.on('value', (snap) => {
            allTasks = snap.val() || {};
            renderTasks();
        });

        document.addEventListener('keydown', (e) => { if(e.key === 'Escape') closeModals(); });
    </script>
</body>
</html>
